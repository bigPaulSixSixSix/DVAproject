# 项目部署前清理清单

## 📋 清理说明

本文档列出了部署前需要清理的文件和目录，以及需要保留但需要单独放置的数据库初始化文件。

---

## 一、需要删除的文件和目录

### 1.1 文档文件（开发文档，生产环境不需要）

#### backup/apply/ 目录下的所有文档
- `backup/apply/前端功能更新文档.md`
- `backup/apply/数据库表清理策略.md`
- `backup/apply/最终确认要点总结.md`
- `backup/apply/实施计划.md`
- `backup/apply/需要确认的细节问题.md`
- `backup/apply/任务编辑和渐进式生成方案分析.md`

**建议操作**：删除整个 `backup/apply/` 目录

#### 其他文档
- `vf_admin/task_test_data/README.md` - 测试数据说明文档

---

### 1.2 开发/迁移脚本（scripts/ 目录）

#### Shell 脚本（.sh）
- `scripts/execute_migration.sh`
- `scripts/fix_apply_tables_comments.sh`
- `scripts/migrate_mysql.sh`
- `scripts/migrate_rename_assignee.sh`
- `scripts/update_approval_nodes_comments.sh`

#### Python 脚本（.py）
- `scripts/clean_test_data.py`
- `scripts/fix_completed_tasks.py`
- `scripts/migrate_simple.py`
- `scripts/migrate_task_apply_simple.py`
- `scripts/migrate_task_apply_tables.py`
- `scripts/migrate_task_approval_fields.py`

#### SQL 脚本（临时修复脚本）
- `scripts/clean_test_data.sql`
- `scripts/fix_apply_tables_comments.sql`
- `scripts/fix_rejected_tasks.sql`
- `scripts/fix_table_comments.sql`
- `scripts/fix_todo_task_apply_comments.sql`
- `scripts/update_approval_nodes_comments.sql`

**建议操作**：删除整个 `scripts/` 目录（这些是开发/迁移过程中的临时脚本）

---

### 1.3 数据库备份文件

- `backup/ruoyi-fastapi_backup_20251017_123725.sql` - 历史备份文件

**建议操作**：删除（如果需要保留备份，应该放在项目外部）

---

### 1.4 测试数据文件

#### vf_admin/task_test_data/ 目录
- `vf_admin/task_test_data/README.md`
- `vf_admin/task_test_data/unnamed_000016_*.json` (共22个测试JSON文件)

#### 其他测试文件
- `vf_admin/routers_test.json` - 路由测试数据

**建议操作**：删除 `vf_admin/task_test_data/` 目录和 `vf_admin/routers_test.json`

---

### 1.5 日志文件

#### logs/ 目录下的所有日志文件
- `logs/2025-12-16_error.log`
- `logs/2025-12-17_error.log`
- `logs/2025-12-18_error.log`
- `logs/2025-12-19_error.log`
- `logs/2025-12-22_error.log`
- `logs/2025-12-23_error.log`
- `logs/2025-12-24_error.log`
- `logs/2025-12-25_error.log`
- `logs/2025-12-26_error.log`
- `logs/2025-12-29_error.log`
- `logs/2025-12-31_error.log`
- `logs/2026-01-04_error.log`
- `logs/2026-01-05_error.log`
- `logs/2026-01-06_error.log`
- `logs/2026-01-07_error.log`
- `logs/2026-01-08_error.log`
- `logs/2026-01-09_error.log`
- `logs/2026-01-12_error.log`

**建议操作**：删除所有 `.log` 文件（生产环境会重新生成）

---

### 1.6 Python 缓存文件

#### __pycache__/ 目录（所有位置）
- 根目录下的 `__pycache__/`
- `config/__pycache__/`
- `exceptions/__pycache__/`
- `middlewares/__pycache__/`
- `middlewares/trace_middleware/__pycache__/`
- `module_admin/annotation/__pycache__/`
- `module_admin/aspect/__pycache__/`
- `module_admin/controller/__pycache__/`
- `module_apply/__pycache__/`
- `module_apply/entity/__pycache__/`
- `module_task/__pycache__/`
- `sub_applications/__pycache__/`
- `utils/__pycache__/`

**建议操作**：删除所有 `__pycache__/` 目录（Python会自动重新生成）

---

### 1.7 虚拟环境（保留）

- `venv/` 目录

**注意**：虚拟环境保留在本地，用于本地运行和测试。提交代码时会单独处理，避免提交venv文件夹。

---

### 1.8 临时目录（空目录，可清理）

- `vf_admin/download_path/` - 空目录
- `vf_admin/gen_path/` - 空目录
- `vf_admin/upload_path/` - 空目录

**注意**：这些目录可能是运行时创建的，如果为空可以删除，但需要确认应用是否需要这些目录。

---

## 二、需要保留但需要单独放置的文件

### 2.1 数据库初始化文件（重要！）

这些文件是数据库初始化必需的，需要单独放置，避免被误用。

#### 主要初始化文件
- `sql/ruoyi-fastapi.sql` - MySQL 数据库完整初始化脚本
- `sql/ruoyi-fastapi-pg.sql` - PostgreSQL 数据库完整初始化脚本

#### 数据库迁移脚本（可选保留）
- `sql/migration_add_task_approval_fields.sql` - 添加审批字段的迁移脚本
- `sql/migration_rename_assignee_to_job_number.sql` - 重命名字段的迁移脚本

**建议操作**：
1. ✅ 已创建 `database_init/` 目录
2. ✅ 已从当前数据库导出最新表结构并更新 `ruoyi-fastapi.sql`
3. ✅ 已在新目录中添加 `README.md` 说明文件
4. ⚠️ 需要将旧的 `sql/ruoyi-fastapi.sql` 和 `sql/ruoyi-fastapi-pg.sql` 移动到 `database_init/` 目录（如果PostgreSQL版本也需要更新）

---

## 三、清理统计

### 需要删除的文件统计
- **文档文件**：7个（6个 .md + 1个 README）
- **脚本文件**：17个（5个 .sh + 6个 .py + 6个 .sql）
- **备份文件**：1个
- **测试数据**：23个（22个 .json + 1个 README）
- **日志文件**：17个
- **Python缓存目录**：约13个 `__pycache__/` 目录

### 需要移动的文件统计
- **数据库初始化文件**：2个主要文件（MySQL + PostgreSQL）
- **迁移脚本**：2个（可选）

---

## 四、清理步骤建议

### 步骤1：创建数据库初始化文件目录
```bash
mkdir database_init
```

### 步骤2：数据库初始化文件（已完成）
✅ 已从当前MySQL数据库导出最新表结构
✅ 已创建 `database_init/ruoyi-fastapi.sql`（包含所有最新表结构）
✅ 已创建 `database_init/README.md` 说明文件

**注意**：如果需要更新PostgreSQL版本，需要：
1. 连接到PostgreSQL数据库
2. 导出表结构
3. 保存为 `database_init/ruoyi-fastapi-pg.sql`

**可选**：移动旧的迁移脚本到 `database_init/` 目录
```bash
mv sql/migration_*.sql database_init/
```

### 步骤4：删除文档目录
```bash
rm -rf backup/apply/
```

### 步骤5：删除脚本目录
```bash
rm -rf scripts/
```

### 步骤6：删除备份文件
```bash
rm backup/ruoyi-fastapi_backup_20251017_123725.sql
```

### 步骤7：删除测试数据
```bash
rm -rf vf_admin/task_test_data/
rm vf_admin/routers_test.json
```

### 步骤8：清理日志文件
```bash
rm logs/*.log
```

### 步骤9：清理Python缓存
```bash
find . -type d -name "__pycache__" -exec rm -r {} +
find . -type f -name "*.pyc" -delete
```

### 步骤10：清理空目录（可选）
```bash
# 如果确认这些目录不需要，可以删除
rmdir vf_admin/download_path vf_admin/gen_path vf_admin/upload_path 2>/dev/null
```

---

## 五、注意事项

1. **数据库初始化文件**：这些文件包含完整的数据库结构，执行会清空现有数据，必须单独放置并明确标注。

2. **备份文件**：如果有重要的备份文件，建议在项目外部（如专门的备份目录）保存，而不是放在项目代码中。

3. **日志文件**：生产环境会重新生成日志，开发日志可以删除。

4. **测试数据**：确保所有测试数据都已清理，避免泄露敏感信息。

5. **虚拟环境**：虚拟环境保留在本地用于开发和测试，提交代码时会单独处理，避免提交到代码仓库。

6. **Python缓存**：`__pycache__` 目录会在运行时自动生成，可以安全删除。

---

## 六、清理后验证

清理完成后，建议验证：
1. 应用能否正常启动
2. 数据库连接是否正常
3. 所有必要的目录是否存在（如 logs/、vf_admin/upload_path/ 等）
4. 没有遗漏重要的配置文件

---

**生成时间**：2026-01-12
**清理状态**：待执行

