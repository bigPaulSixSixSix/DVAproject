# 工作台任务统计接口文档

## 接口概述

用于获取工作台主页"我的任务"板块的统计数据，包括待提交、待审批和被驳回的任务数量。

---

## 接口详情

### 获取工作台任务统计

**接口地址**：`GET /todo/workbench/stats`

**接口描述**：获取当前用户在工作台主页需要显示的任务统计数据。

**请求参数**：无（自动获取当前登录用户信息）

**响应示例**：
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "pendingSubmit": 4,
    "pendingApprove": 3,
    "rejected": 2
  },
  "success": true,
  "time": "2025-01-20 10:00:00"
}
```

**字段说明**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `pendingSubmit` | Number | 待提交任务数量 |
| `pendingApprove` | Number | 待审批任务数量 |
| `rejected` | Number | 被驳回任务数量 |

---

## 业务规则

### 1. 待提交（pendingSubmit）

**统计条件**：
- 任务的负责人（assignee）是当前登录用户
- 任务状态（taskStatus）为 **1（进行中）**
- 任务尚未提交（即任务处于进行中状态，等待负责人提交）

**说明**：仅统计当前状态为"进行中"的任务，不包含"未开始"、"已完成"等其他状态。

---

### 2. 待审批（pendingApprove）

**统计条件**：
- 任务已提交（taskStatus 为 2 或 4）
- 任务存在审批流程（approvalFlow）
- 审批流程中当前审批节点（currentApprovalNode）的状态为 **approving（审批中）**
- 当前审批节点的审批人（approverId）是当前登录用户

**说明**：
- 仅统计当前流转到该用户审批的任务
- 不包含还没轮到该用户审批的任务（pending 状态）
- 不包含该用户已经审批过的任务（approved 状态）
- 需要从 `apply_rules.current_approval_node` 获取当前需要审批的岗位ID，然后查询该岗位对应的员工，判断是否为当前用户

---

### 3. 被驳回（rejected）

**统计条件**：
- 任务的负责人（assignee）是当前登录用户
- 任务状态（taskStatus）为 **4（驳回）**

**说明**：指负责人是当前用户，但他提交的任务被驳回了。

---

## 数据计算

**总数计算**：
- 工作台"我的任务"后面的数字标 = `pendingSubmit + pendingApprove + rejected`

**显示格式**：
- 如果三项都有数据：`"4项待提交 3项待审批 2项被驳回"`
- 如果只有部分有数据：只显示有数据的项，例如 `"4项待提交 3项待审批"`
- 如果都没有数据：显示 `"暂无任务"`

---

## 注意事项

1. 所有统计数据都是实时计算的，不进行缓存
2. 接口需要根据当前登录用户的身份信息进行数据过滤
3. 审批流程的判断需要结合 `apply_rules` 表中的 `current_approval_node` 字段
4. 任务状态字段使用数字：1-进行中，2-已提交，4-驳回

---

## 前端实现说明

**文件位置**：
- API接口定义：`src/api/todo.js` - `getWorkbenchTaskStats()`
- 组件实现：`src/components/Workbench/SummaryCard/TaskCard.vue`

**调用时机**：
- 组件挂载时（`onMounted`）自动调用接口加载数据
- 如果接口调用失败，会使用默认值（全部为0）并显示"暂无任务"

