# ä»»åŠ¡ç¼–è¾‘å’Œæ¸è¿›å¼ç”ŸæˆåŠŸèƒ½ - å‰ç«¯ä¿®æ”¹æ–¹æ¡ˆ

## ğŸ“‹ ä¿®æ”¹æ¦‚è¿°

æ ¹æ®åç«¯æ–‡æ¡£ï¼Œå‰ç«¯éœ€è¦æ”¯æŒï¼š
1. æ ¹æ® `isEditable` å­—æ®µé™åˆ¶ä»»åŠ¡/é˜¶æ®µçš„ç¼–è¾‘æ“ä½œ
2. æ ¹æ® `tasksGenerated` å­—æ®µæ˜¾ç¤ºä¸åŒçš„ä¿å­˜æŒ‰é’®
3. å¤„ç†æœªç”Ÿæˆä»»åŠ¡çš„æ˜¾ç¤ºï¼ˆåœ¨ä»»åŠ¡è¯¦æƒ…é¡µé¢ï¼‰

---

## ä¸€ã€æ•°æ®å±‚ä¿®æ”¹

### 1.1 æ•°æ®æ ¼å¼è½¬æ¢ (`useWorkflowData.js`)

**æ–‡ä»¶**: `composables/workflowdata/useWorkflowData.js`

**ä¿®æ”¹å†…å®¹**:
1. åœ¨ `toFrontendFormat` å‡½æ•°ä¸­å¤„ç† `tasksGenerated` å­—æ®µ
2. åœ¨ `toFrontendFormat` å‡½æ•°ä¸­å¤„ç† `isEditable` å­—æ®µï¼ˆä»»åŠ¡å’Œé˜¶æ®µï¼‰

**å…·ä½“ä¿®æ”¹**:

```javascript
// åœ¨ toFrontendFormat å‡½æ•°ä¸­
const toFrontendFormat = (backendData) => {
  // ... ç°æœ‰ä»£ç  ...
  
  // æå– tasksGeneratedï¼ˆé¡¹ç›®çº§åˆ«ï¼‰
  const tasksGenerated = backendData.tasksGenerated ?? false
  
  // åœ¨å¤„ç†é˜¶æ®µæ—¶ï¼Œæ·»åŠ  isEditable å­—æ®µ
  const processedStages = validStages.map(stage => {
    // ... ç°æœ‰ä»£ç  ...
    return {
      ...stage,
      id: normalizeId(stage.id),
      isEditable: stage.isEditable ?? true, // é»˜è®¤å¯ç¼–è¾‘ï¼ˆå…¼å®¹æ—§æ•°æ®ï¼‰
      predecessorStages: normalizeIdArray(stage.predecessorStages),
      successorStages: normalizeIdArray(stage.successorStages),
      tasks: tasksWithAbsolutePosition.map(task => ({
        ...task,
        id: normalizeId(task.id),
        isEditable: task.isEditable ?? true, // é»˜è®¤å¯ç¼–è¾‘ï¼ˆå…¼å®¹æ—§æ•°æ®ï¼‰
        // ... å…¶ä»–å­—æ®µ ...
      }))
    }
  })
  
  // è¿”å›æ—¶åŒ…å« tasksGenerated
  return { 
    stages: processedStages, 
    unassignedTasks: [],
    tasksGenerated // æ–°å¢
  }
}
```

**æ³¨æ„äº‹é¡¹**:
- `isEditable` é»˜è®¤å€¼ä¸º `true`ï¼ˆå…¼å®¹æ—§æ•°æ®ï¼‰
- `tasksGenerated` é»˜è®¤å€¼ä¸º `false`ï¼ˆå…¼å®¹æ—§æ•°æ®ï¼‰
- éœ€è¦åŒæ—¶å¤„ç†åµŒå¥—ç»“æ„å’Œåˆ†ç¦»ç»“æ„ä¸¤ç§æ•°æ®æ ¼å¼

---

### 1.2 æ•°æ®å­˜å‚¨ (`index.vue`)

**æ–‡ä»¶**: `index.vue`

**ä¿®æ”¹å†…å®¹**:
1. æ·»åŠ  `tasksGenerated` å“åº”å¼å˜é‡
2. åœ¨æ•°æ®åŠ è½½æ—¶æ›´æ–° `tasksGenerated`

**å…·ä½“ä¿®æ”¹**:

```javascript
// åœ¨ index.vue ä¸­
const tasksGenerated = ref(false) // æ–°å¢

// åœ¨ loadWorkflowData æˆ–ç›¸å…³å‡½æ•°ä¸­
const loadWorkflow = async (projectId, loading, workflowData, toFrontendFormat, workflowStore, startAutoSave, unassignedTasks) => {
  // ... ç°æœ‰ä»£ç  ...
  const formattedData = toFrontendFormat(backendWorkflow)
  
  // æ›´æ–° tasksGenerated
  tasksGenerated.value = formattedData.tasksGenerated ?? false
  
  // ... å…¶ä»–ä»£ç  ...
}
```

---

## äºŒã€UIå±‚ä¿®æ”¹

### 2.1 ä¿å­˜æŒ‰é’® (`WorkflowCanvas.vue`)

**æ–‡ä»¶**: `components/WorkflowCanvas.vue`

**ä¿®æ”¹å†…å®¹**:
1. æ ¹æ® `tasksGenerated` æ˜¾ç¤ºä¸åŒçš„æŒ‰é’®æ–‡æœ¬
2. æ·»åŠ æç¤ºä¿¡æ¯ï¼ˆå·²ç”Ÿæˆä»»åŠ¡çš„é¡¹ç›®ï¼‰

**å…·ä½“ä¿®æ”¹**:

```vue
<template>
  <!-- åœ¨å·¥å…·æ ä¸­ -->
  <el-tooltip content="ä¿å­˜" placement="top">
    <el-button 
      class="toolbar-icon-button"
      @click="handleSave"
    >
      <i class="icon-save"></i>
    </el-button>
  </el-tooltip>
  
  <!-- æˆ–è€…æ˜¾ç¤ºæ–‡æœ¬æŒ‰é’® -->
  <el-button 
    type="primary"
    @click="handleSave"
  >
    {{ tasksGenerated ? 'ä¿å­˜å¹¶æ›´æ–°ä»»åŠ¡ç”Ÿæˆ' : 'ä¿å­˜ä»»åŠ¡' }}
  </el-button>
  
  <!-- æç¤ºä¿¡æ¯ -->
  <el-tooltip 
    v-if="tasksGenerated"
    content="ä¿å­˜åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ£€æŸ¥å¹¶ç”Ÿæˆæ»¡è¶³æ¡ä»¶çš„æ–°ä»»åŠ¡"
    placement="top"
  >
    <el-icon class="info-icon">
      <QuestionFilled />
    </el-icon>
  </el-tooltip>
</template>

<script setup>
// æ·»åŠ  props
const props = defineProps({
  tasksGenerated: {
    type: Boolean,
    default: false
  }
})
</script>
```

---

### 2.2 ä»»åŠ¡å¡ç‰‡ (`TaskCard.vue`)

**æ–‡ä»¶**: `components/Task/TaskCard.vue`

**ä¿®æ”¹å†…å®¹**:
1. æ ¹æ® `isEditable` æ˜¾ç¤ºå·²ç”Ÿæˆæ ‡è¯†
2. æ ¹æ® `isEditable` ç¦ç”¨åˆ é™¤æŒ‰é’®
3. æ ¹æ® `isEditable` åº”ç”¨ç°è‰²æ ·å¼

**å…·ä½“ä¿®æ”¹**:

```vue
<template>
  <div 
    class="task-card"
    :class="{
      'task-card--invalid': hasMissingRequiredFields,
      'task-card--time-issue': hasTimeIssue && !hasMissingRequiredFields,
      'task-card--selected': isSelected,
      'task-card--disabled': !task.isEditable, // æ–°å¢
      // ... å…¶ä»–ç±» ...
    }"
  >
    <!-- å·²ç”Ÿæˆæ ‡è¯† -->
    <el-tag 
      v-if="!task.isEditable" 
      type="info" 
      size="small"
      class="task-generated-tag"
    >
      å·²ç”Ÿæˆ
    </el-tag>
    
    <!-- ä»»åŠ¡å†…å®¹ -->
    <div class="task-content">
      <!-- ... ç°æœ‰å†…å®¹ ... -->
    </div>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <Teleport v-if="isSelected" to="#task-action-layer">
      <div class="task-actions" :style="taskActionStyle">
        <el-button 
          size="small" 
          class="task-action-btn task-action-btn--edit"
          @click.stop="handleEdit"
        >
          <el-icon><Edit /></el-icon>
        </el-button>
        <el-button 
          v-if="task.isEditable" // æ–°å¢ï¼šåªæœ‰å¯ç¼–è¾‘çš„ä»»åŠ¡æ‰æ˜¾ç¤ºåˆ é™¤æŒ‰é’®
          size="small" 
          class="task-action-btn task-action-btn--delete"
          @click.stop="handleDelete"
        >
          <el-icon><Delete /></el-icon>
        </el-button>
      </div>
    </Teleport>
  </div>
</template>

<style scoped>
.task-card--disabled {
  opacity: 0.6;
  background-color: #f5f7fa;
  border-color: #e4e7ed;
  cursor: not-allowed;
}

.task-generated-tag {
  position: absolute;
  top: 4px;
  right: 4px;
  z-index: 10;
}
</style>
```

---

### 2.3 é˜¶æ®µå¡ç‰‡ (`StageCard.vue`)

**æ–‡ä»¶**: `components/Stage/StageCard.vue`

**ä¿®æ”¹å†…å®¹**:
1. æ ¹æ® `isEditable` æ˜¾ç¤ºå·²ç”Ÿæˆæ ‡è¯†
2. æ ¹æ® `isEditable` ç¦ç”¨åˆ é™¤æŒ‰é’®
3. æ ¹æ® `isEditable` åº”ç”¨ç°è‰²æ ·å¼

**å…·ä½“ä¿®æ”¹**:

```vue
<template>
  <div 
    class="stage-card"
    :class="{
      'stage-card--selected': isSelected,
      'stage-card--disabled': !stage.isEditable, // æ–°å¢
      // ... å…¶ä»–ç±» ...
    }"
  >
    <!-- é˜¶æ®µæ ‡é¢˜ -->
    <div class="stage-header">
      <div class="stage-title">
        <span class="stage-id">{{ stage?.id }}</span> 
        {{ stage?.name || 'æœªå‘½å' }} 
        {{ stageTimeDisplay }}
        
        <!-- å·²ç”Ÿæˆæ ‡è¯† -->
        <el-tag 
          v-if="!stage.isEditable" 
          type="info" 
          size="small"
          class="stage-generated-tag"
        >
          å·²ç”Ÿæˆ
        </el-tag>
      </div>
      <div class="stage-actions" v-if="isSelected">
        <el-button 
          size="small" 
          class="stage-action-btn stage-action-btn--edit"
          @click.stop="handleEdit"
        >
          <el-icon><Edit /></el-icon>
        </el-button>
        <el-button 
          v-if="stage.isEditable" // æ–°å¢ï¼šåªæœ‰å¯ç¼–è¾‘çš„é˜¶æ®µæ‰æ˜¾ç¤ºåˆ é™¤æŒ‰é’®
          size="small" 
          class="stage-action-btn stage-action-btn--delete"
          @click.stop="handleDelete"
        >
          <el-icon><Delete /></el-icon>
        </el-button>
      </div>
    </div>
  </div>
</template>

<style scoped>
.stage-card--disabled {
  opacity: 0.6;
  background-color: #f5f7fa;
  border-color: #e4e7ed;
}

.stage-generated-tag {
  margin-left: 8px;
}
</style>
```

---

### 2.4 ä»»åŠ¡ç¼–è¾‘å¯¹è¯æ¡† (`TaskEditDialog.vue`)

**æ–‡ä»¶**: `components/Task/TaskEditDialog.vue`

**ä¿®æ”¹å†…å®¹**:
1. æ ¹æ® `isEditable` ç¦ç”¨åŸºæœ¬ä¿¡æ¯ç¼–è¾‘ï¼ˆåç§°ã€æè¿°ã€æ—¶é—´ã€è´Ÿè´£äººã€å®¡æ‰¹èŠ‚ç‚¹ï¼‰
2. æ ¹æ® `isEditable` ç¦ç”¨å‰ç½®å…³ç³»ç¼–è¾‘
3. æ ¹æ® `isEditable` å…è®¸åç½®å…³ç³»ç¼–è¾‘ï¼ˆä½†åªèƒ½æ·»åŠ æœªç”Ÿæˆçš„ä»»åŠ¡ï¼‰
4. æ ¹æ® `isEditable` éšè—åˆ é™¤æŒ‰é’®

**å…·ä½“ä¿®æ”¹**:

```vue
<template>
  <el-dialog v-model="dialogVisible" ...>
    <el-form ref="formRef" :model="form" :rules="dynamicRules">
      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <el-form-item label="ä»»åŠ¡åç§°" prop="name">
        <el-input 
          v-model="form.name" 
          placeholder="è¯·è¾“å…¥ä»»åŠ¡åç§°"
          :disabled="!isEditable" // æ–°å¢
        />
      </el-form-item>
      
      <el-form-item label="ä»»åŠ¡æè¿°">
        <el-input 
          v-model="form.description" 
          type="textarea" 
          :rows="3"
          placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰"
          :disabled="!isEditable" // æ–°å¢
        />
      </el-form-item>
      
      <!-- æ—¶é—´ä¿¡æ¯ -->
      <el-form-item label="æ—¶é—´ä¿¡æ¯" required>
        <el-date-picker
          v-model="form.startTime"
          type="date"
          placeholder="å¼€å§‹æ—¶é—´"
          :disabled="!isEditable" // æ–°å¢
        />
        <!-- ... å…¶ä»–æ—¶é—´å­—æ®µ ... -->
      </el-form-item>
      
      <!-- è´Ÿè´£äºº -->
      <el-form-item label="è´Ÿè´£äºº" prop="jobNumber">
        <el-select
          v-model="form.jobNumber"
          placeholder="è¯·é€‰æ‹©è´Ÿè´£äºº"
          :disabled="!isEditable" // æ–°å¢
        >
          <!-- ... -->
        </el-select>
      </el-form-item>
      
      <!-- å®¡æ‰¹å±‚çº§ -->
      <el-form-item label="å®¡æ‰¹å±‚çº§" prop="approvalLevel">
        <!-- ... -->
        <el-tree-select
          :model-value="form.approvalLevel"
          :disabled="!isEditable" // æ–°å¢
          <!-- ... -->
        />
      </el-form-item>
      
      <!-- å‰ç½®ä»»åŠ¡è¡¨æ ¼ -->
      <el-table :data="predecessorTaskList" ...>
        <el-table-column label="æ“ä½œ" width="100">
          <template #default="{ row }">
            <div class="relation-action-buttons">
              <el-button 
                size="small" 
                type="primary" 
                plain 
                @click="handlePredecessorTaskEdit(row)"
                :disabled="!isEditable" // æ–°å¢ï¼šä¸å¯ç¼–è¾‘ä»»åŠ¡çš„å‰ç½®å…³ç³»ä¸å¯ç¼–è¾‘
              >
                <el-icon><Edit /></el-icon>
              </el-button>
              <el-button 
                size="small" 
                type="info" 
                plain 
                @click="handlePredecessorTaskUnlink(row)"
                :disabled="!isEditable" // æ–°å¢ï¼šä¸å¯ç¼–è¾‘ä»»åŠ¡çš„å‰ç½®å…³ç³»ä¸å¯åˆ é™¤
              >
                <el-icon><Link /></el-icon>
              </el-button>
              <el-button 
                size="small" 
                type="danger" 
                plain 
                @click="handlePredecessorTaskDelete(row)"
                :disabled="!isEditable" // æ–°å¢ï¼šä¸å¯ç¼–è¾‘ä»»åŠ¡çš„å‰ç½®ä»»åŠ¡ä¸å¯åˆ é™¤
              >
                <el-icon><Delete /></el-icon>
              </el-button>
            </div>
          </template>
        </el-table-column>
      </el-table>
      
      <!-- åç½®ä»»åŠ¡è¡¨æ ¼ -->
      <el-table :data="successorTaskList" ...>
        <el-table-column label="æ“ä½œ" width="100">
          <template #default="{ row }">
            <div class="relation-action-buttons">
              <!-- åç½®å…³ç³»å¯ä»¥ç¼–è¾‘ï¼Œä½†åªèƒ½æ·»åŠ æœªç”Ÿæˆçš„ä»»åŠ¡ -->
              <el-button 
                size="small" 
                type="primary" 
                plain 
                @click="handleSuccessorTaskEdit(row)"
                :disabled="!isSuccessorTaskEditable(row)" // æ–°å¢ï¼šæ£€æŸ¥åç½®ä»»åŠ¡æ˜¯å¦å¯ç¼–è¾‘
              >
                <el-icon><Edit /></el-icon>
              </el-button>
              <!-- ... å…¶ä»–æŒ‰é’® ... -->
            </div>
          </template>
        </el-table-column>
      </el-table>
    </el-form>
    
    <template #footer>
      <div class="dialog-footer">
        <el-button 
          v-if="isEditable" // æ–°å¢ï¼šåªæœ‰å¯ç¼–è¾‘çš„ä»»åŠ¡æ‰æ˜¾ç¤ºåˆ é™¤æŒ‰é’®
          type="danger" 
          @click="handleDelete"
        >
          åˆ é™¤
        </el-button>
        <el-button @click="handleCancel">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="handleConfirm">ç¡®è®¤</el-button>
      </div>
    </template>
  </el-dialog>
</template>

<script setup>
// æ·»åŠ  props
const props = defineProps({
  // ... ç°æœ‰ props ...
  isEditable: {
    type: Boolean,
    default: true
  }
})

// æ£€æŸ¥åç½®ä»»åŠ¡æ˜¯å¦å¯ç¼–è¾‘
const isSuccessorTaskEditable = (task) => {
  // å¦‚æœå½“å‰ä»»åŠ¡ä¸å¯ç¼–è¾‘ï¼Œåªèƒ½ç¼–è¾‘æœªç”Ÿæˆçš„åç½®ä»»åŠ¡
  if (!props.isEditable) {
    return task.isEditable === true
  }
  return true
}
</script>
```

---

### 2.5 è¿æ¥å…³ç³»ç¼–è¾‘é™åˆ¶

**æ–‡ä»¶**: `composables/connection/useConnection.js` åŠç›¸å…³æ–‡ä»¶

**ä¿®æ”¹å†…å®¹**:
1. åœ¨åˆ›å»ºè¿æ¥æ—¶ï¼Œæ£€æŸ¥ä»»åŠ¡/é˜¶æ®µçš„ `isEditable` çŠ¶æ€
2. ç¦æ­¢ç¼–è¾‘ä¸å¯ç¼–è¾‘ä»»åŠ¡/é˜¶æ®µçš„å‰ç½®å…³ç³»
3. å…è®¸ç¼–è¾‘ä¸å¯ç¼–è¾‘ä»»åŠ¡/é˜¶æ®µçš„åç½®å…³ç³»ï¼Œä½†åªèƒ½æ·»åŠ å¯ç¼–è¾‘çš„ä»»åŠ¡/é˜¶æ®µ

**å…·ä½“ä¿®æ”¹**:

```javascript
// åœ¨ useConnection.js ä¸­
const createConnectionBetweenElements = async (fromElement, toElement) => {
  // ... ç°æœ‰éªŒè¯ä»£ç  ...
  
  // æ–°å¢ï¼šæ£€æŸ¥å‰ç½®å…³ç³»ç¼–è¾‘é™åˆ¶
  // å¦‚æœç›®æ ‡å…ƒç´ ä¸å¯ç¼–è¾‘ï¼Œä¸”è¿™æ˜¯å‰ç½®å…³ç³»ï¼ˆä»å…¶ä»–å…ƒç´ è¿æ¥åˆ°å®ƒï¼‰ï¼Œåˆ™ç¦æ­¢
  const toElementInfo = fromElement.type === 'task' 
    ? findTaskById(toElement.id)
    : findStageById(toElement.id)
  
  if (toElementInfo && !toElementInfo.isEditable) {
    // æ£€æŸ¥æ˜¯å¦æ˜¯å‰ç½®å…³ç³»ï¼ˆé€šè¿‡æ£€æŸ¥ fromElement æ˜¯å¦åœ¨ toElement çš„å‰ç½®åˆ—è¡¨ä¸­ï¼‰
    const isPredecessorRelation = checkIsPredecessorRelation(fromElement, toElement)
    if (isPredecessorRelation) {
      ElMessage.warning('ä¸å…è®¸ç¼–è¾‘å·²ç”Ÿæˆä»»åŠ¡/é˜¶æ®µçš„å‰ç½®å…³ç³»')
      return false
    }
  }
  
  // æ–°å¢ï¼šæ£€æŸ¥åç½®å…³ç³»ç¼–è¾‘é™åˆ¶
  // å¦‚æœæºå…ƒç´ ä¸å¯ç¼–è¾‘ï¼Œä¸”è¦æ·»åŠ çš„åç½®å…ƒç´ ä¹Ÿä¸å¯ç¼–è¾‘ï¼Œåˆ™ç¦æ­¢
  const fromElementInfo = fromElement.type === 'task'
    ? findTaskById(fromElement.id)
    : findStageById(fromElement.id)
  
  if (fromElementInfo && !fromElementInfo.isEditable) {
    if (toElementInfo && !toElementInfo.isEditable) {
      ElMessage.warning('å·²ç”Ÿæˆçš„ä»»åŠ¡/é˜¶æ®µåªèƒ½æ·»åŠ æœªç”Ÿæˆçš„ä»»åŠ¡/é˜¶æ®µä½œä¸ºåç½®')
      return false
    }
  }
  
  // ... å…¶ä»–ä»£ç  ...
}
```

---

## ä¸‰ã€ä»»åŠ¡è¯¦æƒ…é¡µé¢ä¿®æ”¹

### 3.1 å‰åç½®ä»»åŠ¡å…³ç³»æ˜¾ç¤º (`TaskRelations.vue`)

**æ–‡ä»¶**: `views/workbench/todo/components/TaskDetail/TaskRelations.vue`

**ä¿®æ”¹å†…å®¹**:
1. å¤„ç†æœªç”Ÿæˆä»»åŠ¡çš„æ˜¾ç¤ºï¼ˆ`taskStatus = -1`ï¼‰
2. æ˜¾ç¤ºç‰¹æ®Šæ ‡è¯†å’Œæ ·å¼
3. å¤„ç† null å€¼å­—æ®µ

**å…·ä½“ä¿®æ”¹**:

```vue
<template>
  <div class="task-relations-card">
    <!-- ... ç°æœ‰ä»£ç  ... -->
    
    <!-- å‰ç½®ä»»åŠ¡ -->
    <div v-for="task in predecessorTasks" :key="getTaskId(task)">
      <div
        class="relation-task-card"
        :class="[
          getTaskStatusClass(task),
          { 'task-card--ungenerated': task.taskStatus === -1 } // æ–°å¢
        ]"
      >
        <div class="task-header">
          <div class="task-title">
            {{ getTaskName(task) }}
            <!-- æœªç”Ÿæˆæ ‡è¯† -->
            <el-tag 
              v-if="task.taskStatus === -1"
              type="info"
              size="small"
              class="ungenerated-tag"
            >
              æœªç”Ÿæˆ
            </el-tag>
          </div>
        </div>
        <div class="task-content">
          <el-tag 
            :type="getStatusTagType(task)"
            size="small"
          >
            {{ getStatusText(task) }}
          </el-tag>
          <span class="task-info">
            {{ formatTaskDates(task) }} {{ getAssigneeName(task) }}
          </span>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
// ä¿®æ”¹ getStatusText å‡½æ•°
const getStatusText = (task) => {
  if (task.taskStatus === -1) {
    return 'æœªç”Ÿæˆ'
  }
  return task.taskStatusName || 'æœªçŸ¥'
}

// ä¿®æ”¹ formatTaskDates å‡½æ•°ï¼Œå¤„ç† null å€¼
const formatTaskDates = (task) => {
  if (task.taskStatus === -1) {
    return '-' // æœªç”Ÿæˆä»»åŠ¡ï¼Œæ˜¾ç¤º "-"
  }
  const startTime = task.actualStartTime || task.startTime || '-'
  const endTime = task.actualCompleteTime || task.endTime || '-'
  return `${startTime} ~ ${endTime}`
}
</script>

<style scoped>
.task-card--ungenerated {
  opacity: 0.6;
  border-style: dashed;
  border-color: #909399;
}

.ungenerated-tag {
  margin-left: 8px;
}
</style>
```

---

## å››ã€æ¥å£è°ƒæ•´

### 4.1 API æ¥å£ (`api/workflow.js`)

**æ–‡ä»¶**: `api/workflow.js`

**ä¿®æ”¹å†…å®¹**:
1. ç¡®è®¤æ¥å£è·¯å¾„æ­£ç¡®ï¼ˆåç«¯æ–‡æ¡£ä¸­çš„è·¯å¾„ï¼‰
2. ç¡®è®¤è¯·æ±‚/å“åº”æ ¼å¼

**æ£€æŸ¥é¡¹**:
- `GET /task/config/{project_id}` â†’ `fetchWorkflowByProjectId` âœ…ï¼ˆå·²å­˜åœ¨ï¼‰
- `POST /task/save` â†’ `saveTaskConfig` âœ…ï¼ˆå·²å­˜åœ¨ï¼‰
- `GET /todo/task/detail/{task_id}` â†’ éœ€è¦æ£€æŸ¥æ˜¯å¦å­˜åœ¨

---

## äº”ã€ä¿®æ”¹æ¸…å•

### 5.1 å¿…é¡»ä¿®æ”¹çš„æ–‡ä»¶

1. âœ… `composables/workflowdata/useWorkflowData.js` - æ•°æ®æ ¼å¼è½¬æ¢
2. âœ… `index.vue` - æ·»åŠ  `tasksGenerated` çŠ¶æ€
3. âœ… `components/WorkflowCanvas.vue` - ä¿å­˜æŒ‰é’®æ–‡æœ¬
4. âœ… `components/Task/TaskCard.vue` - ä»»åŠ¡å¡ç‰‡æ ·å¼å’Œåˆ é™¤æŒ‰é’®
5. âœ… `components/Stage/StageCard.vue` - é˜¶æ®µå¡ç‰‡æ ·å¼å’Œåˆ é™¤æŒ‰é’®
6. âœ… `components/Task/TaskEditDialog.vue` - ç¼–è¾‘å¯¹è¯æ¡†é™åˆ¶
7. âœ… `composables/connection/useConnection.js` - è¿æ¥å…³ç³»ç¼–è¾‘é™åˆ¶
8. âœ… `views/workbench/todo/components/TaskDetail/TaskRelations.vue` - æœªç”Ÿæˆä»»åŠ¡æ˜¾ç¤º

### 5.2 å¯é€‰ä¿®æ”¹çš„æ–‡ä»¶

1. `components/Stage/StageEditDialog.vue` - é˜¶æ®µç¼–è¾‘å¯¹è¯æ¡†ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
2. `composables/task/useTaskEdit.js` - ä»»åŠ¡ç¼–è¾‘é€»è¾‘ï¼ˆå¯èƒ½éœ€è¦æ·»åŠ  `isEditable` æ£€æŸ¥ï¼‰

---

## å…­ã€æµ‹è¯•è¦ç‚¹

### 6.1 åŠŸèƒ½æµ‹è¯•

1. **æœªç”Ÿæˆä»»åŠ¡çš„é¡¹ç›®**:
   - [ ] æ‰€æœ‰ä»»åŠ¡/é˜¶æ®µéƒ½å¯ä»¥ç¼–è¾‘
   - [ ] ä¿å­˜æŒ‰é’®æ˜¾ç¤º"ä¿å­˜ä»»åŠ¡"
   - [ ] å¯ä»¥åˆ é™¤ä»»åŠ¡/é˜¶æ®µ

2. **å·²ç”Ÿæˆä»»åŠ¡çš„é¡¹ç›®**:
   - [ ] å·²ç”Ÿæˆä»»åŠ¡/é˜¶æ®µæ˜¾ç¤ºç°è‰²æ ·å¼
   - [ ] å·²ç”Ÿæˆä»»åŠ¡/é˜¶æ®µæ˜¾ç¤º"å·²ç”Ÿæˆ"æ ‡ç­¾
   - [ ] å·²ç”Ÿæˆä»»åŠ¡/é˜¶æ®µçš„åŸºæœ¬ä¿¡æ¯ä¸å¯ç¼–è¾‘
   - [ ] å·²ç”Ÿæˆä»»åŠ¡/é˜¶æ®µçš„å‰ç½®å…³ç³»ä¸å¯ç¼–è¾‘
   - [ ] å·²ç”Ÿæˆä»»åŠ¡/é˜¶æ®µçš„åç½®å…³ç³»å¯ä»¥ç¼–è¾‘ï¼Œä½†åªèƒ½æ·»åŠ æœªç”Ÿæˆä»»åŠ¡
   - [ ] å·²ç”Ÿæˆä»»åŠ¡/é˜¶æ®µä¸å¯åˆ é™¤
   - [ ] ä¿å­˜æŒ‰é’®æ˜¾ç¤º"ä¿å­˜å¹¶æ›´æ–°ä»»åŠ¡ç”Ÿæˆ"

3. **ä»»åŠ¡è¯¦æƒ…é¡µé¢**:
   - [ ] æœªç”Ÿæˆä»»åŠ¡æ˜¾ç¤º"æœªç”Ÿæˆ"æ ‡ç­¾
   - [ ] æœªç”Ÿæˆä»»åŠ¡çš„æ‰§è¡Œç›¸å…³å­—æ®µæ˜¾ç¤ºä¸º "-"
   - [ ] æœªç”Ÿæˆä»»åŠ¡ä½¿ç”¨è™šçº¿è¾¹æ¡†æ ·å¼

### 6.2 è¾¹ç•Œæƒ…å†µæµ‹è¯•

1. **æ•°æ®å…¼å®¹æ€§**:
   - [ ] `isEditable` å­—æ®µç¼ºå¤±æ—¶ï¼Œé»˜è®¤å¯ç¼–è¾‘
   - [ ] `tasksGenerated` å­—æ®µç¼ºå¤±æ—¶ï¼Œé»˜è®¤æœªç”Ÿæˆ

2. **é”™è¯¯å¤„ç†**:
   - [ ] åç«¯è¿”å›ç¼–è¾‘é™åˆ¶é”™è¯¯æ—¶ï¼Œæ˜¾ç¤ºå‹å¥½æç¤º
   - [ ] å°è¯•ç¼–è¾‘ä¸å¯ç¼–è¾‘ä»»åŠ¡æ—¶ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯

---

## ä¸ƒã€æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**: ç¡®ä¿æ—§æ•°æ®ï¼ˆæ²¡æœ‰ `isEditable` å’Œ `tasksGenerated` å­—æ®µï¼‰èƒ½æ­£å¸¸å·¥ä½œ
2. **æ€§èƒ½ä¼˜åŒ–**: `isEditable` æ˜¯åŠ¨æ€è®¡ç®—çš„ï¼Œä¸éœ€è¦å‰ç«¯ç¼“å­˜
3. **ç”¨æˆ·ä½“éªŒ**: å¯¹äºä¸å¯ç¼–è¾‘çš„ä»»åŠ¡/é˜¶æ®µï¼Œæä¾›æ˜ç¡®çš„è§†è§‰åé¦ˆ
4. **é”™è¯¯æç¤º**: åœ¨ä¿å­˜å‰è¿›è¡Œå‰ç«¯æ ¡éªŒï¼Œå‡å°‘ä¸å¿…è¦çš„è¯·æ±‚

---

## å…«ã€é—®é¢˜è®¨è®º

1. **é˜¶æ®µç¼–è¾‘å¯¹è¯æ¡†**: æ˜¯å¦éœ€è¦åˆ›å»ºé˜¶æ®µç¼–è¾‘å¯¹è¯æ¡†ï¼Ÿå¦‚æœéœ€è¦ï¼Œéœ€è¦ç±»ä¼¼ä»»åŠ¡ç¼–è¾‘å¯¹è¯æ¡†çš„é™åˆ¶é€»è¾‘ã€‚

2. **è¿æ¥ç‚¹äº¤äº’**: ä¸å¯ç¼–è¾‘ä»»åŠ¡/é˜¶æ®µçš„å‰ç½®è¿æ¥ç‚¹æ˜¯å¦åº”è¯¥éšè—æˆ–ç¦ç”¨ï¼Ÿå»ºè®®ï¼šç¦ç”¨äº¤äº’ï¼Œä½†ä¿ç•™è§†è§‰æ˜¾ç¤ºã€‚

3. **ä¿å­˜æç¤º**: å·²ç”Ÿæˆä»»åŠ¡çš„é¡¹ç›®ä¿å­˜æ—¶ï¼Œæ˜¯å¦éœ€è¦æ˜¾ç¤º"æ­£åœ¨ç”Ÿæˆæ–°ä»»åŠ¡"çš„åŠ è½½æç¤ºï¼Ÿ

4. **æœªç”Ÿæˆä»»åŠ¡è¯¦æƒ…**: æœªç”Ÿæˆä»»åŠ¡æ˜¯å¦å¯ä»¥ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ï¼Ÿå»ºè®®ï¼šå¯ä»¥ç‚¹å‡»ï¼Œä½†è¯¦æƒ…é¡µé¢æ˜¾ç¤º"ä»»åŠ¡æœªç”Ÿæˆ"çš„æç¤ºã€‚

---

**æ–‡æ¡£ç»“æŸ**

