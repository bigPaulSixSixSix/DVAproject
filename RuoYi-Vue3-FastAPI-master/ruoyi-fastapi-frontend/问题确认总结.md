# 我的任务页面 - 问题确认总结

## ✅ 已确认的问题

### 1. 部门分类处理
- **确认**：后端会处理部门层级关系
- **实现方式**：通过部门的code字段（如02A01B01C01对应的第二级部门是02A01）
- **前端处理**：直接使用后端返回的第二级部门分类数据，无需额外处理

### 2. 图片上传功能
- **确认**：先只实现文字相关的功能，图片上传功能后续再实现
- **实现方式**：提交内容和审批意见接口中的 `submitImages` 和 `approvalImages` 字段暂时传空数组 `[]`

### 3. 时间格式和计算
- **确认**：使用本地时间（datetime.now()，不包含时区信息）
- **数据库字段**：MySQL使用DATETIME，PostgreSQL使用TIMESTAMP WITHOUT TIME ZONE
- **时间格式**：`YYYY-MM-DD HH:MM:SS`（例如：2025-01-20 10:00:00）
- **前端处理**：
  - 使用系统现有的 `parseTime` 工具函数（`@/utils/ruoyi`）格式化时间
  - 剩余时间计算：使用本地时间计算时间差（不涉及时区转换）
  - 逾期时间也使用本地时间计算，不涉及跨时区问题

### 4. 审批权限判断
- **确认**：后端会处理审批权限判断
- **实现方式**：
  - 后端数据库中有一个表专门存储当前审批人，会查询并返回给对应的用户
  - 后端接口返回 `canApprove` 字段
  - 岗位（编制）与用户是一对一关系（可能有编制为空，但一个用户只可能在一个编制上）
- **前端处理**：根据 `canApprove` 字段显示/隐藏审批按钮

---

## ❓ 需要确认的问题（已全部确认）

### 1. 剩余时间计算 ✅
**问题**：任务列表接口中的 `deadlineRemaining` 字段是后端计算返回，还是前端需要自己计算？

**回复**：// 前端自己计算。因为这个时间是实时更新的。不可能后端一直在更新这个时间。

**确认结果**：
- ✅ 前端根据 `deadline` 字段和当前时间计算剩余时间
- ✅ 格式：剩余X小时X分
- ✅ 接口文档已更新，移除了 `deadlineRemaining` 字段

---

### 2. 审批流程中的当前审批人信息 ✅
**问题**：审批流程中，当前审批节点（`status: "approving"`）是否需要显示当前审批人的信息？

**回复**：// 需要显示审批人。你需要在你的接口文档中标注需要这个字段，然后由后端开发。

**确认结果**：
- ✅ 审批中节点（`status: "approving"`）必须返回当前审批人的ID和姓名
- ✅ 即使还未审批，也要返回当前应该审批的人信息
- ✅ 接口文档已更新，明确标注了该要求

---

### 3. 任务列表的排序规则 ✅
**问题**：任务列表的默认排序规则是什么？

**回复**：// 按正序排列。实际场景就是，早就发了的任务，你到现在还没执行，更应该注意它们。

**确认结果**：
- ✅ 默认按任务创建时间正序排列（早创建的任务排在前面）
- ✅ 接口文档已更新

---

### 4. 驳回任务的驳回原因显示 ✅
**问题**：驳回任务的驳回原因（`rejectReason`）是否在任务列表接口中返回？

**回复**：// 仔细查看页面。驳回原因不需要在任务列表页显示。只在任务明细页面中显示就行。

**确认结果**：
- ✅ 任务列表接口不需要返回 `rejectReason` 字段
- ✅ 驳回原因只在任务详情接口中返回（`rejectInfo.rejectReason`）
- ✅ 接口文档已更新

### 5. 任务详情的提交内容 ✅
**问题**：任务详情接口中的 `submitContent` 字段，如果任务被驳回后重新提交，是否只显示最新的提交内容？

**回复**：// 这个先不用管。后面会有一个复杂的重复提交/查看之前提交记录的功能。

**确认结果**：
- ✅ 当前版本只显示最新一次的提交内容
- ✅ 历史提交记录功能后续再开发

---

## 📝 其他建议

### 1. 接口响应时间 ✅
**问题**：接口的响应时间要求，特别是分类统计和任务列表接口

**回复**：// 这里有两个问题。首先后端需要全部查询一次，返回该账户的各种任务的计数。这样才能显示。然后在点击某个分类时，再请求这个分类下任务列表的查询。

**确认结果**：
- ✅ 分类统计接口：后端需要全部查询一次，返回该账户各种任务的计数
- ✅ 任务列表接口：点击某个分类时，再请求这个分类下任务列表的查询
- ✅ 接口文档已更新，明确了两个接口的调用时机

### 2. 错误处理
- 建议确认各种错误场景的处理方式
- 例如：网络错误、权限错误、数据不存在等

### 3. 数据刷新频率
- 建议确认是否需要实时刷新数据
- 或者使用轮询机制定期刷新

---

## 总结

✅ **所有问题已全部确认！**

1. ✅ 剩余时间计算：前端自己计算（实时更新，需考虑跨天情况）
2. ✅ 审批流程中当前审批人：必须返回当前审批人信息（从 apply_rules.current_approval_node 获取岗位，查询该岗位对应的员工）
3. ✅ 任务列表排序：按创建时间正序排列
4. ✅ 驳回原因显示：只在任务详情中显示，不在任务列表中显示（暂时不实现，先实现正常任务）
5. ✅ 提交内容历史：当前版本只显示最新一次，历史记录功能后续开发
6. ✅ 接口调用时机：分类统计和任务列表是分开的两个接口

**剩余时间计算规则**：
- 剩余时间 < 24小时：显示"剩余X小时X分"
- 剩余时间 >= 24小时：显示"剩余X天X小时"
- 已逾期：显示"已逾期X天X小时"或"已逾期X小时X分"

**下一步**：可以开始前端开发工作了！
